from app.functions import *
import requests
import os
from dotenv import load_dotenv
import sendgrid
from sendgrid.helpers.mail import *
from newsapi.newsapi_client import NewsApiClient
import json
import datetime
import pytest


CI_ENV = os.environ.get("CI", "OOPS") == "true" # expect default environment variable setting of "CI=true" on Travis CI, see: https://docs.travis-ci.com/user/environment-variables/#default-environment-variables
SKIP_REASON = "to avoid issuing requests from the CI server"

#Load from .env file
load_dotenv()
SENDGRID_API_KEY = os.environ.get("SENDGRID_API_KEY", "OOPS, please set env var called 'SENDGRID_API_KEY'")
MY_EMAIL_ADDRESS = os.environ.get("MY_EMAIL_ADDRESS", "OOPS, please set env var called 'MY_EMAIL_ADDRESS'")
NEWS_API_KEY = os.environ.get("NEWS_API_KEY", "OOPS, please set env var called 'NEWS_API_KEY'")
SENDGRID_TEMPLATE_ID = os.environ.get("SENDGRID_TEMPLATE_ID", "OOPS, please set env var called 'SENDGRID_TEMPLATE_ID'" )
OPENWEATHER_API_KEY = os.environ.get("OPENWEATHER_API_KEY", "OOPS, please set env var valled 'OPENWEATHER_API_KEY'")

#Test the Kelvin Conversion Function
def test_Kelvin():
	k = KelvinToFahrenheit(298)
	assert k == 77

#Test the ability to get headlines. Only locally because it uses API Keys
@pytest.mark.skipif(CI_ENV==True, reason=SKIP_REASON)
def test_Get_Headlines():
	assert NEWS_API_KEY != "OOPS, please set env var called 'NEWS_API_KEY'"
	newsapi = NewsApiClient(api_key=NEWS_API_KEY)
	wsj_top_headlines = newsapi.get_top_headlines(sources='the-wall-street-journal')
	assert len(wsj_top_headlines) == 3

#Test the ability to parse the API response into Headlines. Uses a dummy return object.
def test_Parse_Headlines():
	news_api_response = {'status': 'ok', 'totalResults': 10, 'articles': [{'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Jenny Strasburg', 'title': 'Deutsche Bank, Commerzbank Merger Talks Hit Stumbling Blocks', 'description': 'Merger talks between Deutsche Bank and Commerzbank have gotten bogged down over questions ranging from a lack of investor support to opposition from powerful labor unions.', 'url': 'https://www.wsj.com/articles/deutsche-bank-commerzbank-merger-talks-hit-stumbling-blocks-11556150695?mod=hp_lead_pos7', 'urlToImage': 'https://images.wsj.net/im-69181/social', 'publishedAt': '2019-04-25T00:04:00Z', 'content': 'Merger talks between Deutsche Bank AG and Commerzbank AG have gotten bogged down over questions ranging from a lack of investor support to opposition from powerful labor unions, according to people familiar with the matter.\r\nThe banks as of Wednesday evening … [+208 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Paul Kiernan', 'title': 'Moore Hopeful for Fed Post, but Says He Would Bow Out If He Becomes Liability', 'description': 'Stephen Moore said he was hopeful about his chances of being nominated and confirmed to the Fed board but would drop out if he became a political liability for the Trump administration or Senate Republicans.', 'url': 'https://www.wsj.com/articles/moore-hopeful-for-fed-post-but-says-he-would-bow-out-if-he-becomes-liability-11556143736?mod=hp_lead_pos10', 'urlToImage': 'https://images.wsj.net/im-69272/social', 'publishedAt': '2019-04-24T22:08:00Z', 'content': 'WASHINGTONConservative commentator Stephen Moore said he was hopeful about his chances of being nominated and confirmed to the Federal Reserve Board of Governors but would bow out of the process if he became a political liability for the Trump administration … [+227 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Tim Higgins', 'title': 'Tesla Reports Loss Amid Struggles Delivering Model 3 Cars', 'description': 'Tesla reported one of its worst quarterly losses on record, wider than Wall Street was expecting, as the auto maker struggles with delivering the Model 3 compact car.', 'url': 'https://www.wsj.com/articles/tesla-reports-loss-amid-stuggles-delivering-model-3-cars-11556141829?mod=hp_lead_pos4', 'urlToImage': 'https://images.wsj.net/im-69441/social', 'publishedAt': '2019-04-24T21:37:00Z', 'content': 'Tesla Inc. on Wednesday reported one of its worst quarterly losses on record, wider than Wall Street was expecting, as the auto makers struggles with delivering the Model 3 compact car have raised questions about the rosy growth projected by Chief Executive E… [+269 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Dustin Volz', 'title': 'NSA Recommends Dropping Phone-Surveillance Program', 'description': 'The National Security Agency has recommended that the White House abandon a U.S. surveillance program that collects information about Americans’ phone calls and text messages, saying the logistical and legal burdens of keeping it outweigh its intelligence ben…', 'url': 'https://www.wsj.com/articles/nsa-recommends-dropping-phone-surveillance-program-11556138247?mod=hp_lead_pos2', 'urlToImage': 'https://images.wsj.net/im-69374/social', 'publishedAt': '2019-04-24T20:37:00Z', 'content': 'The National Security Agency has recommended that the White House abandon a U.S. surveillance program that collects information about Americans phone calls and text messages, saying the logistical and legal burdens of keeping it outweigh its intelligence bene… [+273 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Jeff Horwitz', 'title': 'Facebook Sets Aside $3 Billion to Cover Expected FTC Fine', 'description': 'Facebook set aside $3 billion for an expected fine from the Federal Trade Commission over privacy issues, cutting into profit even as its underlying business remained strong.', 'url': 'https://www.wsj.com/articles/facebook-sets-aside-3-billion-to-cover-expected-ftc-fine-11556137113?mod=hp_lead_pos1', 'urlToImage': 'https://images.wsj.net/im-69018/social', 'publishedAt': '2019-04-24T20:18:00Z', 'content': 'Facebook Inc. set aside $3 billion for an expected fine from the Federal Trade Commission over privacy issues, cutting into the social-media giants profits even as its underlying business remained strong.\r\nFacebook posted $15.08 billion in revenue, up 26% fro… [+169 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Joe Morgenstern', 'title': '‘Avengers: Endgame’ Review: A Marvelous Wrap', 'description': 'The power of friendship supercharges the heroic finale of Marvel’s series.', 'url': 'https://www.wsj.com/articles/avengers-endgame-review-a-marvelous-wrap-11556124677?mod=hp_lead_pos8', 'urlToImage': 'https://si.wsj.net/public/resources/images/B3-DU476_AVENGE_SOC_20190424104844.jpg', 'publishedAt': '2019-04-24T16:51:00Z', 'content': 'Watch a clip from the movie Avengers: Endgame. Photo: Walt Disney Pictures\r\nGood news for humanity, and for the significant fraction of it thats been following the exploits of the Avengers and their allies in 21 Marvel movies over the past 11 years. The peopl… [+435 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Michael Rothfeld', 'title': 'Michael Cohen, in Recorded Phone Call, Walks Back Parts of Guilty Plea', 'description': 'President Trump’s former lawyer has disavowed responsibility for some of the crimes to which he has pleaded guilty, privately contending in a recent recorded phone call with actor Tom Arnold that he hadn’t evaded taxes and that a criminal charge related to hi…', 'url': 'https://www.wsj.com/articles/michael-cohen-in-recorded-phone-call-walks-back-parts-of-guilty-plea-11556121974?mod=hp_lead_pos6', 'urlToImage': 'https://images.wsj.net/im-69140/social', 'publishedAt': '2019-04-24T16:06:00Z', 'content': 'Michael Cohen has disavowed responsibility for some of the crimes to which he has pleaded guilty, privately contending in a recent recorded phone call that he hadnt evaded taxes and that a criminal charge related to his home-equity line of credit was a lie.\r\n… [+271 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Joe Flint', 'title': 'Netflix Fights to Keep Its Most Watched Shows: ‘Friends’ and ‘The Office’', 'description': 'Hollywood studios that licensed old TV shows to Netflix are getting into streaming and want their hits back. It’s a threat to Netflix because its viewers spend much of their time watching reruns.', 'url': 'https://www.wsj.com/articles/netflix-battles-rivals-for-its-most-watched-shows-friends-and-the-office-11556120136?mod=hp_lead_pos5', 'urlToImage': 'https://si.wsj.net/public/resources/images/B3-DU334_NETFLI_SOC_20190423205230.jpg', 'publishedAt': '2019-04-24T15:35:00Z', 'content': 'Netflix Inc. may soon have to contemplate life without its No. 1 show. Its The Office.\r\nNBCUniversal, which owns the show, licensed reruns of the comedy to the streaming-video giant years ago. Now NBCUniversal is launching its own streaming service, and has b… [+156 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Michael C. Bender', 'title': 'Trump Says He Will Fight Subpoenas Related to Mueller Report', 'description': 'President Trump’s refusal to cooperate with Congress over lawmakers’ questions about special counsel Robert Mueller’s report marks a heightening of White House’s resistance to congressional oversight.', 'url': 'https://www.wsj.com/articles/trump-says-white-house-will-fight-mcgahn-subpoena-11556119173?mod=hp_lead_pos3', 'urlToImage': 'https://images.wsj.net/im-69264/social', 'publishedAt': '2019-04-24T15:19:00Z', 'content': 'WASHINGTONPresident Trump said that he would resist all efforts by Congress to question current and former administration officials about special counsel Robert Muellers report, his latest in a series of blunt-force responses to what is traditionally a carefu… [+165 chars]'}, {'source': {'id': 'the-wall-street-journal', 'name': 'The Wall Street Journal'}, 'author': 'Scott McCartney', 'title': 'First Class vs. Coach: A Game of Square Inches', 'description': 'Which part of the plane gets you the most bang for your buck? You might pay three times as much for 45% more space.', 'url': 'https://www.wsj.com/articles/first-class-vs-coach-a-game-of-square-inches-11556098201?mod=hp_lead_pos9', 'urlToImage': 'https://si.wsj.net/public/resources/images/B3-DT964_Midsea_SOC_20190422154251.jpg', 'publishedAt': '2019-04-24T09:30:00Z', 'content': 'The cost of comfort on airlines is going up.\r\nThe gap between the average prices of economy tickets and business- and first-class tickets has widened about 5% the past two years, according to data compiled for The Wall Street Journal by Airlines Reporting Cor… [+152 chars]'}]}
	parsed_headlines = ['Deutsche Bank, Commerzbank Merger Talks Hit Stumbling Blocks', 'Moore Hopeful for Fed Post, but Says He Would Bow Out If He Becomes Liability', 'Tesla Reports Loss Amid Struggles Delivering Model 3 Cars', 'NSA Recommends Dropping Phone-Surveillance Program', 'Facebook Sets Aside $3 Billion to Cover Expected FTC Fine', '‘Avengers: Endgame’ Review: A Marvelous Wrap', 'Michael Cohen, in Recorded Phone Call, Walks Back Parts of Guilty Plea', 'Netflix Fights to Keep Its Most Watched Shows: ‘Friends’ and ‘The Office’', 'Trump Says He Will Fight Subpoenas Related to Mueller Report', 'First Class vs. Coach: A Game of Square Inches']
	titleResponse = FormatTopHeadlines(news_api_response,"title")
	assert titleResponse == parsed_headlines

#Test the ability to get weather data from the API
@pytest.mark.skipif(CI_ENV==True, reason=SKIP_REASON)
def test_Get_Weather():
	fullWeather = requests.get('https://api.openweathermap.org/data/2.5/forecast?zip=20057&APPID='+OPENWEATHER_API_KEY)
	assert OPENWEATHER_API_KEY != "OOPS, please set env var valled 'OPENWEATHER_API_KEY'"
	assert fullWeather.status_code == 200

#Test the ability to parse the Weather Data.
@pytest.mark.skipif(CI_ENV==True, reason=SKIP_REASON)
def test_Weather_Parser():
	fullWeather = requests.get('https://api.openweathermap.org/data/2.5/forecast?zip=20057&APPID='+OPENWEATHER_API_KEY)
	parsed_weather = TemperatureParser(fullWeather)
	assert parsed_weather[0] > parsed_weather[1]

#Test whether or not the Rain Detector works
def rain_parser_test():
	full_weather = {'cod': '200', 'message': 0.0095, 'cnt': 40, 'list': [{'dt': 1556161200, 'main': {'temp': 287.05, 'temp_min': 287.05, 'temp_max': 288.6, 'pressure': 1013.46, 'sea_level': 1013.46, 'grnd_level': 1001.91, 'humidity': 58, 'temp_kf': -1.55}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 100}, 'wind': {'speed': 2.08, 'deg': 4.885}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-25 03:00:00'}, {'dt': 1556172000, 'main': {'temp': 285.06, 'temp_min': 285.06, 'temp_max': 286.217, 'pressure': 1013.62, 'sea_level': 1013.62, 'grnd_level': 1002.05, 'humidity': 61, 'temp_kf': -1.16}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 89}, 'wind': {'speed': 0.93, 'deg': 26.373}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-25 06:00:00'}, {'dt': 1556182800, 'main': {'temp': 285.66, 'temp_min': 285.66, 'temp_max': 286.432, 'pressure': 1013.25, 'sea_level': 1013.25, 'grnd_level': 1001.42, 'humidity': 58, 'temp_kf': -0.77}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 94}, 'wind': {'speed': 1.23, 'deg': 355.202}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-25 09:00:00'}, {'dt': 1556193600, 'main': {'temp': 286.29, 'temp_min': 286.29, 'temp_max': 286.678, 'pressure': 1013.66, 'sea_level': 1013.66, 'grnd_level': 1001.92, 'humidity': 63, 'temp_kf': -0.39}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 97}, 'wind': {'speed': 1.44, 'deg': 31.753}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-25 12:00:00'}, {'dt': 1556204400, 'main': {'temp': 291.51, 'temp_min': 291.51, 'temp_max': 291.51, 'pressure': 1013.67, 'sea_level': 1013.67, 'grnd_level': 1002.1, 'humidity': 48, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 100}, 'wind': {'speed': 1.87, 'deg': 91.471}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-25 15:00:00'}, {'dt': 1556215200, 'main': {'temp': 295.713, 'temp_min': 295.713, 'temp_max': 295.713, 'pressure': 1012.4, 'sea_level': 1012.4, 'grnd_level': 1000.45, 'humidity': 44, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 96}, 'wind': {'speed': 1.89, 'deg': 122.025}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-25 18:00:00'}, {'dt': 1556226000, 'main': {'temp': 295.759, 'temp_min': 295.759, 'temp_max': 295.759, 'pressure': 1010.7, 'sea_level': 1010.7, 'grnd_level': 998.6, 'humidity': 52, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 85}, 'wind': {'speed': 1.31, 'deg': 124.999}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-25 21:00:00'}, {'dt': 1556236800, 'main': {'temp': 291.572, 'temp_min': 291.572, 'temp_max': 291.572, 'pressure': 1010.17, 'sea_level': 1010.17, 'grnd_level': 998.03, 'humidity': 68, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10n'}], 'clouds': {'all': 92}, 'wind': {'speed': 2.21, 'deg': 101.463}, 'rain': {'3h': 0.375}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-26 00:00:00'}, {'dt': 1556247600, 'main': {'temp': 289.832, 'temp_min': 289.832, 'temp_max': 289.832, 'pressure': 1009.73, 'sea_level': 1009.73, 'grnd_level': 997.34, 'humidity': 75, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 99}, 'wind': {'speed': 3.57, 'deg': 131.355}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-26 03:00:00'}, {'dt': 1556258400, 'main': {'temp': 288.426, 'temp_min': 288.426, 'temp_max': 288.426, 'pressure': 1007.41, 'sea_level': 1007.41, 'grnd_level': 995.4, 'humidity': 90, 'temp_kf': 0}, 'weather': [{'id': 501, 'main': 'Rain', 'description': 'moderate rain', 'icon': '10n'}], 'clouds': {'all': 99}, 'wind': {'speed': 2.76, 'deg': 148.901}, 'rain': {'3h': 3.438}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-26 06:00:00'}, {'dt': 1556269200, 'main': {'temp': 289.473, 'temp_min': 289.473, 'temp_max': 289.473, 'pressure': 1004.3, 'sea_level': 1004.3, 'grnd_level': 991.96, 'humidity': 93, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10n'}], 'clouds': {'all': 100}, 'wind': {'speed': 2.9, 'deg': 165.284}, 'rain': {'3h': 0.75}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-26 09:00:00'}, {'dt': 1556280000, 'main': {'temp': 289.804, 'temp_min': 289.804, 'temp_max': 289.804, 'pressure': 1001.99, 'sea_level': 1001.99, 'grnd_level': 989.55, 'humidity': 87, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'clouds': {'all': 100}, 'wind': {'speed': 6.45, 'deg': 182.755}, 'rain': {'3h': 1.375}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-26 12:00:00'}, {'dt': 1556290800, 'main': {'temp': 291.52, 'temp_min': 291.52, 'temp_max': 291.52, 'pressure': 998.39, 'sea_level': 998.39, 'grnd_level': 986.88, 'humidity': 83, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'clouds': {'all': 100}, 'wind': {'speed': 7.41, 'deg': 189.189}, 'rain': {'3h': 1.625}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-26 15:00:00'}, {'dt': 1556301600, 'main': {'temp': 291.72, 'temp_min': 291.72, 'temp_max': 291.72, 'pressure': 993.85, 'sea_level': 993.85, 'grnd_level': 983.27, 'humidity': 82, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'clouds': {'all': 98}, 'wind': {'speed': 6.34, 'deg': 189.126}, 'rain': {'3h': 2}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-26 18:00:00'}, {'dt': 1556312400, 'main': {'temp': 291.74, 'temp_min': 291.74, 'temp_max': 291.74, 'pressure': 992.45, 'sea_level': 992.45, 'grnd_level': 980.05, 'humidity': 81, 'temp_kf': 0}, 'weather': [{'id': 501, 'main': 'Rain', 'description': 'moderate rain', 'icon': '10d'}], 'clouds': {'all': 100}, 'wind': {'speed': 5.96, 'deg': 232.392}, 'rain': {'3h': 3.25}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-26 21:00:00'}, {'dt': 1556323200, 'main': {'temp': 284.852, 'temp_min': 284.852, 'temp_max': 284.852, 'pressure': 996.42, 'sea_level': 996.42, 'grnd_level': 985.21, 'humidity': 64, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10n'}], 'clouds': {'all': 99}, 'wind': {'speed': 9.29, 'deg': 315.763}, 'rain': {'3h': 0.062}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-27 00:00:00'}, {'dt': 1556334000, 'main': {'temp': 285.68, 'temp_min': 285.68, 'temp_max': 285.68, 'pressure': 999.37, 'sea_level': 999.37, 'grnd_level': 987.88, 'humidity': 48, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 100}, 'wind': {'speed': 9.26, 'deg': 315.796}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-27 03:00:00'}, {'dt': 1556344800, 'main': {'temp': 285.007, 'temp_min': 285.007, 'temp_max': 285.007, 'pressure': 1001.92, 'sea_level': 1001.92, 'grnd_level': 990.7, 'humidity': 50, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 100}, 'wind': {'speed': 7.6, 'deg': 308.5}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-27 06:00:00'}, {'dt': 1556355600, 'main': {'temp': 282.1, 'temp_min': 282.1, 'temp_max': 282.1, 'pressure': 1004.2, 'sea_level': 1004.2, 'grnd_level': 992.73, 'humidity': 56, 'temp_kf': 0}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'clouds': {'all': 57}, 'wind': {'speed': 6.38, 'deg': 303.139}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-27 09:00:00'}, {'dt': 1556366400, 'main': {'temp': 282.081, 'temp_min': 282.081, 'temp_max': 282.081, 'pressure': 1007.66, 'sea_level': 1007.66, 'grnd_level': 995.47, 'humidity': 48, 'temp_kf': 0}, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'clouds': {'all': 28}, 'wind': {'speed': 8.47, 'deg': 306.224}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-27 12:00:00'}, {'dt': 1556377200, 'main': {'temp': 286.119, 'temp_min': 286.119, 'temp_max': 286.119, 'pressure': 1009.06, 'sea_level': 1009.06, 'grnd_level': 997.94, 'humidity': 34, 'temp_kf': 0}, 'weather': [{'id': 800, 'main': 'Clear', 'description': 'clear sky', 'icon': '01d'}], 'clouds': {'all': 0}, 'wind': {'speed': 6.96, 'deg': 306.644}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-27 15:00:00'}, {'dt': 1556388000, 'main': {'temp': 290.234, 'temp_min': 290.234, 'temp_max': 290.234, 'pressure': 1008.73, 'sea_level': 1008.73, 'grnd_level': 997.65, 'humidity': 27, 'temp_kf': 0}, 'weather': [{'id': 800, 'main': 'Clear', 'description': 'clear sky', 'icon': '01d'}], 'clouds': {'all': 0}, 'wind': {'speed': 6.15, 'deg': 295.04}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-27 18:00:00'}, {'dt': 1556398800, 'main': {'temp': 290.961, 'temp_min': 290.961, 'temp_max': 290.961, 'pressure': 1009.1, 'sea_level': 1009.1, 'grnd_level': 997.76, 'humidity': 32, 'temp_kf': 0}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'clouds': {'all': 67}, 'wind': {'speed': 4.89, 'deg': 299.223}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-27 21:00:00'}, {'dt': 1556409600, 'main': {'temp': 287.088, 'temp_min': 287.088, 'temp_max': 287.088, 'pressure': 1011.89, 'sea_level': 1011.89, 'grnd_level': 1000.19, 'humidity': 44, 'temp_kf': 0}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'clouds': {'all': 83}, 'wind': {'speed': 3.15, 'deg': 321.229}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-28 00:00:00'}, {'dt': 1556420400, 'main': {'temp': 283.812, 'temp_min': 283.812, 'temp_max': 283.812, 'pressure': 1013.6, 'sea_level': 1013.6, 'grnd_level': 1001.71, 'humidity': 66, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10n'}], 'clouds': {'all': 100}, 'wind': {'speed': 1.1, 'deg': 358.961}, 'rain': {'3h': 0.562}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-28 03:00:00'}, {'dt': 1556431200, 'main': {'temp': 283.3, 'temp_min': 283.3, 'temp_max': 283.3, 'pressure': 1012.02, 'sea_level': 1012.02, 'grnd_level': 1000.09, 'humidity': 73, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10n'}], 'clouds': {'all': 96}, 'wind': {'speed': 1.43, 'deg': 144.611}, 'rain': {'3h': 0.313}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-28 06:00:00'}, {'dt': 1556442000, 'main': {'temp': 283.2, 'temp_min': 283.2, 'temp_max': 283.2, 'pressure': 1009.01, 'sea_level': 1009.01, 'grnd_level': 996.6, 'humidity': 64, 'temp_kf': 0}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'clouds': {'all': 78}, 'wind': {'speed': 4.2, 'deg': 158.533}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-28 09:00:00'}, {'dt': 1556452800, 'main': {'temp': 285.958, 'temp_min': 285.958, 'temp_max': 285.958, 'pressure': 1007.73, 'sea_level': 1007.73, 'grnd_level': 995.69, 'humidity': 72, 'temp_kf': 0}, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'clouds': {'all': 79}, 'wind': {'speed': 4.73, 'deg': 191.752}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-28 12:00:00'}, {'dt': 1556463600, 'main': {'temp': 293.93, 'temp_min': 293.93, 'temp_max': 293.93, 'pressure': 1006.35, 'sea_level': 1006.35, 'grnd_level': 994.9, 'humidity': 52, 'temp_kf': 0}, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'clouds': {'all': 34}, 'wind': {'speed': 7.55, 'deg': 244.151}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-28 15:00:00'}, {'dt': 1556474400, 'main': {'temp': 291.4, 'temp_min': 291.4, 'temp_max': 291.4, 'pressure': 1009.05, 'sea_level': 1009.05, 'grnd_level': 998.69, 'humidity': 45, 'temp_kf': 0}, 'weather': [{'id': 500, 'main': 'Rain', 'description': 'light rain', 'icon': '10d'}], 'clouds': {'all': 44}, 'wind': {'speed': 9.5, 'deg': 267.799}, 'rain': {'3h': 0.188}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-28 18:00:00'}, {'dt': 1556485200, 'main': {'temp': 287.022, 'temp_min': 287.022, 'temp_max': 287.022, 'pressure': 1015.94, 'sea_level': 1015.94, 'grnd_level': 1004.51, 'humidity': 50, 'temp_kf': 0}, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'clouds': {'all': 30}, 'wind': {'speed': 9.53, 'deg': 320.282}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-28 21:00:00'}, {'dt': 1556496000, 'main': {'temp': 282.2, 'temp_min': 282.2, 'temp_max': 282.2, 'pressure': 1022.32, 'sea_level': 1022.32, 'grnd_level': 1009.98, 'humidity': 60, 'temp_kf': 0}, 'weather': [{'id': 801, 'main': 'Clouds', 'description': 'few clouds', 'icon': '02n'}], 'clouds': {'all': 15}, 'wind': {'speed': 5.48, 'deg': 340.94}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-29 00:00:00'}, {'dt': 1556506800, 'main': {'temp': 279.4, 'temp_min': 279.4, 'temp_max': 279.4, 'pressure': 1026.5, 'sea_level': 1026.5, 'grnd_level': 1014.05, 'humidity': 64, 'temp_kf': 0}, 'weather': [{'id': 800, 'main': 'Clear', 'description': 'clear sky', 'icon': '01n'}], 'clouds': {'all': 0}, 'wind': {'speed': 4.13, 'deg': 341.153}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-29 03:00:00'}, {'dt': 1556517600, 'main': {'temp': 277.121, 'temp_min': 277.121, 'temp_max': 277.121, 'pressure': 1028.44, 'sea_level': 1028.44, 'grnd_level': 1016.03, 'humidity': 69, 'temp_kf': 0}, 'weather': [{'id': 800, 'main': 'Clear', 'description': 'clear sky', 'icon': '01n'}], 'clouds': {'all': 0}, 'wind': {'speed': 2.25, 'deg': 333.891}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-29 06:00:00'}, {'dt': 1556528400, 'main': {'temp': 276.204, 'temp_min': 276.204, 'temp_max': 276.204, 'pressure': 1029.56, 'sea_level': 1029.56, 'grnd_level': 1017, 'humidity': 70, 'temp_kf': 0}, 'weather': [{'id': 800, 'main': 'Clear', 'description': 'clear sky', 'icon': '01n'}], 'clouds': {'all': 0}, 'wind': {'speed': 1.56, 'deg': 333.83}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-29 09:00:00'}, {'dt': 1556539200, 'main': {'temp': 279.022, 'temp_min': 279.022, 'temp_max': 279.022, 'pressure': 1031.59, 'sea_level': 1031.59, 'grnd_level': 1019.29, 'humidity': 58, 'temp_kf': 0}, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'clouds': {'all': 35}, 'wind': {'speed': 1.71, 'deg': 354.363}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-29 12:00:00'}, {'dt': 1556550000, 'main': {'temp': 285.3, 'temp_min': 285.3, 'temp_max': 285.3, 'pressure': 1030.73, 'sea_level': 1030.73, 'grnd_level': 1018.79, 'humidity': 35, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 91}, 'wind': {'speed': 2.47, 'deg': 116.981}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-29 15:00:00'}, {'dt': 1556560800, 'main': {'temp': 289.178, 'temp_min': 289.178, 'temp_max': 289.178, 'pressure': 1027.83, 'sea_level': 1027.83, 'grnd_level': 1015.95, 'humidity': 30, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 89}, 'wind': {'speed': 3.94, 'deg': 148.604}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-29 18:00:00'}, {'dt': 1556571600, 'main': {'temp': 289.6, 'temp_min': 289.6, 'temp_max': 289.6, 'pressure': 1025.31, 'sea_level': 1025.31, 'grnd_level': 1012.84, 'humidity': 35, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'clouds': {'all': 100}, 'wind': {'speed': 5.29, 'deg': 155.364}, 'sys': {'pod': 'd'}, 'dt_txt': '2019-04-29 21:00:00'}, {'dt': 1556582400, 'main': {'temp': 286, 'temp_min': 286, 'temp_max': 286, 'pressure': 1025.22, 'sea_level': 1025.22, 'grnd_level': 1012.78, 'humidity': 48, 'temp_kf': 0}, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'clouds': {'all': 100}, 'wind': {'speed': 5.35, 'deg': 142.467}, 'sys': {'pod': 'n'}, 'dt_txt': '2019-04-30 00:00:00'}], 'city': {'id': 420007998, 'name': 'Washington D.C.', 'coord': {'lat': 38.895, 'lon': -77.0367}, 'country': 'US'}}
	rain = True
	assert RainParser(full_weather) == True


#Test the connection with Sendgrid
@pytest.mark.skipif(CI_ENV==True, reason=SKIP_REASON)
def test_Sendgrid():
	assert SENDGRID_API_KEY != "OOPS, please set env var called 'SENDGRID_API_KEY'"
	assert SENDGRID_TEMPLATE_ID != "OOPS, please set env var called 'SENDGRID_TEMPLATE_ID'"
	message = Mail(
    from_email='from_email@example.com',
    to_emails='to@example.com',
    subject='Sending with Twilio SendGrid is Fun',
    html_content='<strong>and easy to do anywhere, even with Python</strong>')
	sendgrid_client = sendgrid.SendGridAPIClient(SENDGRID_API_KEY)
	response = sendgrid_client.send(message)
	assert response.status_code == 202
